<html>
  <head>
    <title>Turing machine</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script language="JavaScript" src="compiler.js"></script>
    <script language="JavaScript" src="simulation.js"></script>
    <script language="JavaScript" src="test.js"></script>
    <script language="JavaScript">
addEventListener("load", initialize, false);

var tape_canvas, tape_ccontext, machine, sim = null
  , guiEnabled = true
function initialize() {
  tape_ccontext = document.getElementById('tape_canvas').getContext('2d');
  tape_canvas = tape_ccontext.canvas;
  tape_ccontext.save();
  
  compile();
  resetSimulation();
}

function openDescription() {
  if (sim != null && sim.info == 'running') return;
  document.getElementById('description').style.display = 'block'
  document.getElementById('simulation').style.display = 'none'
  document.getElementById('test').style.display = 'none'
  
  document.getElementById('description_button').style.backgroundColor = 'lightblue'
  document.getElementById('simulation_button').style.backgroundColor = 'lightgrey'
  document.getElementById('test_button').style.backgroundColor = 'lightgrey'
}
function openSimulation() {
  document.getElementById('description').style.display = 'none'
  document.getElementById('simulation').style.display = 'block'
  document.getElementById('test').style.display = 'none'
  
  document.getElementById('description_button').style.backgroundColor = 'lightgrey'
  document.getElementById('simulation_button').style.backgroundColor = 'lightblue'
  document.getElementById('test_button').style.backgroundColor = 'lightgrey'
  
  resetSimulation();
}
function openTest() {
  document.getElementById('description').style.display = 'none'
  document.getElementById('simulation').style.display = 'none'
  document.getElementById('test').style.display = 'block'
  
  document.getElementById('description_button').style.backgroundColor = 'lightgrey'
  document.getElementById('simulation_button').style.backgroundColor = 'lightgrey'
  document.getElementById('test_button').style.backgroundColor = 'lightblue'
}

function setCharAt(str,index,chr) {
	if(index > str.length-1) return str;
	return str.substr(0,index) + chr + str.substr(index+1);
}
function setToString(array) {
  var out = '{'
  array.forEach(function (val) {out += val+', '})
  return out.substring(0, out.length-2) + '}'
}
function arrayToString(array) {
  var out = ''
  array.forEach(function (val) {out += val+', '})
  return out.substring(0, out.length-2)
}
function arrayEqu(a1, a2) {
  if (a1.length != a2.length) return false
  for (i = 0; i < a1.length; a1 ++) if (a1[i] != a2[i]) return false
  return true;
}
function findNextTransition() {
  var t, diff
  for (var i = 0; i < machine.transitions.length; i++) {
    t = machine.transitions[i]
    if (t.origin != sim.state) continue
    diff = false
    for (var j = 0; j < t.read.length; j++) {
      if (t.read[j] != sim.tapes[j].content[sim.tapes[j].head_pos]) {
        diff = true
        break
      }
    }
    if (diff) continue
    
    return {index: i, transition: t}
  }
  return null
}


function disableGui(mode) {
  guiEnabled = false
  var els = getElementsByClassName("button")
  els.forEach(function (val) {
    if (mode != 'all' && val.id == 'runpause') return
    val.style.backgroundColor = 'lightgrey'
    val.onmouseover = function() { val.style.backgroundColor = 'lightgrey' }
    val.onmouseout = function() { val.style.backgroundColor = 'lightgrey' }
  })
}
function enableGui() {
  guiEnabled = true
  var els = getElementsByClassName("button")
  els.forEach(function (val) {
    val.style.backgroundColor = 'white'
    val.onmouseover = function() { val.style.backgroundColor = 'lightblue' }
    val.onmouseout = function() { val.style.backgroundColor = 'white' }
  })
}
function getElementsByClassName(classname, node)  {
    if(!node) node = document.getElementsByTagName("body")[0];
    var a = [];
    var re = new RegExp('\\b' + classname + '\\b');
    var els = node.getElementsByTagName("*");
    for(var i=0,j=els.length; i<j; i++)
        if(re.test(els[i].className))a.push(els[i]);
    return a;
}

    </script>
  </head>
  <body>
    <div>
      <a id="description_button" href="javascript:if(guiEnabled) openDescription()" class="button tabButton" style="margin-left:0px; border-top-left-radius:5px">Description</a>
      <a id="simulation_button" href="javascript:if(guiEnabled) openSimulation()" class="button tabButton" style="background-color:lightblue">Simulation</a>
      <a id="test_button" href="javascript:if(guiEnabled) openTest()" class="button tabButton" style="border-top-right-radius:5px">Test</a>
      <a class="github_link" href="http://github.com/tychon/turing_simulator" style="float: right; text-align: right">This project on GitHub</a>
    </div>
    <div id="machine" style="min-width:300px; float:right"></div>
    <div id="tabPane" style="float:left">
      <div id="description" class="tab" style="display:none">
        <a href="javascript:if(guiEnabled) compile()" class="button">compile</a>
        <input id="componthefly" type="checkbox" checked style="margin-left:10px"/> Compile on the fly
        <span class="tip" style="margin-left:10px">(Result shown in the box on the right.)</span><br>
        <table><tbody>
          <tr><td>Number of tapes: <input id="tape_count" type="text" value="3" size="2" onkeyup="if(guiEnabled) descrChanged()" /></td>
              <td>Blank Symbol: <input id="blank_symbol" type="text" value="_" size="1" onkeyup="if(guiEnabled) descrChanged()"/></td></tr>
          <tr><td>Initial state: <input id="initial_state" type="text" value="q1" size="5" onkeyup="if(guiEnabled) descrChanged()"/></td>
              <td>Final state: <input id="final_state" type="text" value="qf" size="5" onkeyup="if(guiEnabled) descrChanged()"/></td></tr>
        </tbody></table>
        <input id="offline" type="checkbox" onclick="if(guiEnabled) descrChanged()" /> Offline TM <span class="tip">(Move only R on the first tape.)</span><br>
        <textarea id="transitions" rows="10" cols="70" onkeyup="if(guiEnabled) descrChanged()">
(q1, _, _, _) -> (qf, 1, _, _, N, N, N)
(q1, a, _, _) -> (q2, a, a, x, R, R, R)
(q1, b, _, _) -> (q2, b, b, x, R, R, R)
(q2, a, _, _) -> (q3, a, a, _, R, R, N)
(q2, b, _, _) -> (q3, b, b, _, R, R, N)
(q2, _, _, _) -> (qf, 0, _, _, N, N, N)
(q3, a, _, _) -> (q2, a, a, x, R, R, R)
(q3, b, _, _) -> (q2, b, b, x, R, R, R)
(q3, _, _, _) -> (q4, _, _, _, L, L, L)
(q4, a, a, x) -> (q4, a, _, x, L, L, L)
(q4, b, b, x) -> (q4, b, _, x, L, L, L)
(q4, a, a, _) -> (q4, a, a, _, N, L, N)
(q4, b, b, _) -> (q4, b, b, _, N, L, N)
(q4, a, b, _) -> (q4, a, b, _, N, L, N)
(q4, b, a, _) -> (q4, b, a, _, N, L, N)
(q4, a, _, _) -> (q5, a, _, _, R, R, N)
(q4, b, _, _) -> (q5, b, _, _, R, R, N)
(q5, a, a, _) -> (q5, a, a, _, R, R, N)
(q5, b, b, _) -> (q5, b, b, _, R, R, N)
(q5, a, b, _) -> (qf, 0, b, _, N, N, N)
(q5, b, a, _) -> (qf, 0, a, _, N, N, N)
(q5, _, _, _) -> (qf, 1, _, _, N, N, N)
</textarea><br>
        <pre id="compiler_errors" style="color:red; background-color:orange"></pre>
        <input id="autocompl_determinism" type="checkbox" onclick="if(guiEnabled) descrChanged()" /> All other transitions behave like transition number
          <input id="autocompl_number" type="text" size="2" disabled onkeyup="if(guiEnabled) descrChanged()" />.<br>
        <span id="autocompl_tip" class="tip" style="display:none">(Numbering for transition corresponds to order in the textarea above.<br>(Malformed transitions excluded!))<br></span>
        <span style="display:none"><input id="sort_transitions" type="checkbox" /> Sort transitions<br></span>
        <br>
        This TM ...<br>
        <input id="type_calculator" type="radio" name="type_group"  onclick="if(guiEnabled) descrChanged()" />calculates a partial function.<br>
        <span class="tip">(The TM halts for every input and the word the head is pointing to is the result.)</span><br>
        <input id="type_decision_maker" type="radio" name="type_group" onclick="if(guiEnabled) descrChanged()" checked />decides a language.<br>
        <span class="tip">(The TM is a decider / a total Turing machine: Halts for every input with 0 or 1)</span><br>
        <input id="type_acceptor" type="radio" name="type_group" onclick="if(guiEnabled) descrChanged()" />accepts a language.<br>
        <span class="tip">(The TM halts with 1 or loops.)</span><br>
      </div>
      
      
      <div id="simulation" class="tab" style="display:block">
        Input: <input id="sim_input" type="text" value="abbabb" onkeyup="if(guiEnabled) resetSimulation()"/>
        <!--<a href="javascript:startSimulation()" class="simButton">Start</a>-->
        <a href="javascript:if(guiEnabled) resetSimulation()" class="button">Reset</a><br>
        <span class="tip">(Characters not in the alphabet are filtered out.)</span>
        <div id="canvas_container" style="margin:5px; padding:5px">
          <canvas id="tape_canvas" width="500" height="100">Der Browser unterstuetzt kein HTML5 !</canvas>
        </div>
        <div>
          <span style="float:right">Status: <span id="sim_info" style="font-size:large"></span><br><span id="sim_info_text"></span></span>
          <a href="javascript:if(guiEnabled) { disableGui('all'); sim_step(function(){enableGui()}) }" class="button">STEP</a>
          <a id="runpause" href="javascript: if (document.getElementById('runpause').innerHTML == 'PAUSE') sim.info = 'pause' ; else sim_run()" class="button">RUN</a>
          <a href="javascript:if(guiEnabled) sim_revert()" class="button">Revert last step</a><br>
          Geschwindigkeit: <span class="tip">(fast)</span><input id="speed_slider" type="range" min="100" max="5000" value="1000" step="100" style="margin-top:10px"/><span class="tip">(slowly)</span><br>
          <span style="display:none">Band Anzeigegröße: <input id="tape_size_slider" type="range" min="0" max="50" value="30" step="2" /></span><br>
          <span style="display:none"><input id="parallel_tape_processing" type="checkbox" checked> Parallel tape processing<br></span>
        </div>
        <div id="configurations" style="max-width: 500px; font-family: monospace"></div>
      </div>
      
      
      <div id="test" class="tab" style="display:none">TODO</div>
    </div>
    <div style="float:right">
      <span class="tip">Parsed TM as JSON:</span><br><textarea id="machine_json" rows="10" cols="60" readonly></textarea>
    </div>
  </body>
</html>
